---
- name: Telegraf play
  hosts: test-kitchen

  vars_files:
    - roles/ansible-telegraf/test/input-plugins-vars.yml
    - roles/ansible-telegraf/test/output-plugins-vars.yml

  pre_tasks:
    - name: Copy metrics.py
      copy: 
        src: roles/ansible-telegraf/test/metrics.py
        dest: /opt/metrics.py
        owner: root
        group: root
        mode:  0755

  roles:
    - wunzeco.docker
    - wunzeco.influxdb
    - ansible-telegraf

  post_tasks:
    - name: Start tomcat container (to test http_response plugin)
      docker_container:
        name: tomcat
        image: tomcat
        published_ports: [ "8888:8080" ]
        state: started
    - name: Start kong-dashboard container (to test http_response plugin)
      docker_container:
        name: kong-dashboard
        image: pgbi/kong-dashboard 
        published_ports: [ "8080:8080" ]
        state: started
